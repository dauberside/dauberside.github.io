# デイリーダイジェスト - 2025-12-10

## 今日のフォーカス

### 優先度：高
（タスクなし）

### 通常タスク
（タスクなし）

### タグなしタスク
（タスクなし）

## 進捗

### 🔧 Recipe スケジュール修正完了 (18:20-18:30 JST)
- **カテゴリ**: maintenance
- **所要時間**: 10m
- **メモ**: 夜間自動化バッチのスケジュール最適化
- **対象 Recipe**:
  - Recipe 13: Nightly Wrap-up → **20:00 JST**
  - Recipe 14: Daily Digest Generator → **20:10 JST**
  - Recipe 02: KB Index Rebuild → **20:30 JST**
  - Recipe 10: TODO.md Auto-sync → **20:40 JST**
- **曜日制限**: 日・月・水・金・土のみ（**火・木除外** = 夜勤シフト考慮）
- **Cron 式**: 各 Recipe で個別設定
  - Recipe 13: `0 20 * * 0,1,3,5,6`
  - Recipe 14: `10 20 * * 0,1,3,5,6`
  - Recipe 02: `30 20 * * 0,1,3,5,6`
  - Recipe 10: `40 20 * * 0,1,3,5,6`
- **効果**: 
  - 夜勤日（火・木）の自動実行を停止 → 睡眠時間確保
  - 10分間隔で順次実行 → 依存関係を考慮した設計
  - tomorrow.json → digest.md → KB rebuild → TODO sync の流れが確立

### 🔍 Recipe 10 診断と誤診の訂正 (21:30-22:05 JST)
- **カテゴリ**: diagnostics
- **所要時間**: 35m
- **トリガー**: `/diagnose` でTODO.mdが12/08で停止していることを検出

**結論**: Recipe 10は正常。問題はスケジュールと運用側。

**正しい前提**:
- 20:10 Recipe 14 → 20:40 Recipe 10 が成功すれば TODO.md は自動更新される
- Mac が起動していて n8n が稼働していること
- Recipe 10 は **Daily Digest から未完了タスクを抽出** して TODO.md に反映（`brief-{date}.json` ではない）

**誤診の経緯**:
1. 初期診断: TODO.md が 12/08 で停止 → Recipe 10 が実行されていないと判断
2. 仮説1: タイムゾーン問題（cron が UTC 解釈で JST 20:40 に実行されない）
3. 仮説2: cron 設定ミス（`40 20` → `40 11` に修正すべき）
4. **訂正**: n8n コンテナは `TZ=Asia/Tokyo` で動作しており、cron は JST で正しく解釈されていた
5. **真の原因**: 旧スケジュール（朝）が回っていなかった + 新スケジュール（夜）にまだ乗っていなかった

**対応**:
- 誤診用ドキュメント（RECIPE-10-FIX.md）を削除
- Recipe 10 を再有効化（誤って無効化してしまったため）
- n8n を再起動して設定を反映

**学び**:
- **「Recipe が壊れている」と「ループが回っていない」は別の問題**
- Recipe 10 自体はテスト成功済みで、ロジックに問題なし
- これは「効率性」ではなく **「ループの一貫性・連携確認」** の話
- 診断時は「実行ログの有無」だけでなく「タイムゾーン設定」「スケジュール履歴」も確認すべき

**次回への改善点**:
- Recipe のテスト成功履歴を先に確認する（誤診の時間短縮）
- n8n のタイムゾーン設定を docker-compose.yml で確認する習慣化
- 今夜 20:40 の Recipe 10 実行で TODO.md が自動更新されることを確認

---

## 振り返り

### 💡 学び

**Recipe スケジュール設計の重要性**
- 依存関係を考慮した順序: Recipe 13 → 14 → 02 → 10
- 10分間隔で tomorrow.json の書き込み完了を待つ設計
- 夜勤シフト（火・木）を Cron 式で除外する実装が有効

**n8n の Custom Cron の落とし穴**
- 複数の Recipe で同じ Cron 式 `0,10,30,40 20 * * 0,1,3,5,6` を使うと、全 Recipe が 4 回ずつ実行されてしまう
- 各 Recipe は **個別の時刻** で設定する必要がある:
  - Recipe 13: `0 20 ...` (20:00 のみ)
  - Recipe 14: `10 20 ...` (20:10 のみ)
  - Recipe 02: `30 20 ...` (20:30 のみ)
  - Recipe 10: `40 20 ...` (20:40 のみ)

**Recipe 02 の "Reload KB API" 問題**
- KB rebuild は成功しているが、"Reload KB API" ステップが失敗
- 原因: KB API プロセスが起動していない
- 対処: KB API が不要なら該当ノードを削除 or スキップ設定

### 🎯 次回への改善点

- Recipe 02 の "Reload KB API" ノードを削除 or 修正（明日対応）
- 今晩 20:00 以降の自動実行で全 Recipe が正常動作するか確認
- Recipe 実行ログを `/diagnose` で確認する習慣化

---

**生成日時**: 2025-12-10T09:26:17.065Z  
**ソース**: TODO.md（自動抽出）