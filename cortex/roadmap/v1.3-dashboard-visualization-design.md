# Category Analytics Dashboard - Visualization Design

**Status**: ðŸŽ¨ Design / Planning
**Data Source**: `cortex/state/category_heatmap.json`
**Target**: Visual insights into task category patterns over time

---

## Data Source Structure

```json
{
  "2025-12-14": {
    "other": 1,
    "n8n": 1,
    "docs": 1
  },
  "2025-12-15": {
    "other": 1,
    "n8n": 1,
    "docs": 1
  }
}
```

**Data Characteristics**:
- Date-keyed (YYYY-MM-DD format)
- Category counts per date
- Cumulative over time (grows daily)
- Typical size: ~30-90 days of data

---

## Visualization Options

### Option 1: Heatmap Calendar View

**What**: GitHub-style contribution calendar showing task density by category

**Layout**:
```
       Mon Tue Wed Thu Fri Sat Sun
Week 1  3   5   2   4   7   1   0
Week 2  4   6   3   5   8   2   1
       [darker = more tasks]
```

**Color Scheme**:
- ops: Red spectrum
- n8n: Purple spectrum
- cortex: Blue spectrum
- docs: Green spectrum
- github: Orange spectrum
- infra: Gray spectrum

**Tools**:
- D3.js calendar heatmap
- Chart.js with custom rendering
- Cal-Heatmap library

**Pros**:
- âœ… Visual pattern recognition (busy days, quiet days)
- âœ… Familiar GitHub-style interface
- âœ… Compact representation

**Cons**:
- âŒ Limited to single category view at once
- âŒ Doesn't show category distribution

---

### Option 2: Stacked Area Chart

**What**: Time-series showing category distribution over time

**Layout**:
```
Tasks
  10 â”‚     â”Œâ”€â”€â”€â”€â”€githubâ”€â”€â”€â”€â”
   8 â”‚   â”Œâ”€infraâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   6 â”‚ â”Œâ”€n8nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
   4 â”‚â”€opsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚â”‚
   2 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚â”‚â”‚
   0 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Time
     12/01          12/15       12/31
```

**Tools**:
- Chart.js stacked area
- Recharts (React)
- Plotly.js

**Pros**:
- âœ… Shows category distribution trends
- âœ… Identifies category workload shifts
- âœ… Good for 30+ days of data

**Cons**:
- âŒ Can be cluttered with many categories
- âŒ Requires more vertical space

---

### Option 3: Category Breakdown Table

**What**: Simple tabular view with statistics

**Layout**:
```markdown
| Category | Last 7d | Last 30d | % of Total | Trend |
|----------|---------|----------|------------|-------|
| ops      | 12      | 45       | 35%        | â†‘     |
| n8n      | 8       | 30       | 23%        | â†’     |
| cortex   | 10      | 28       | 22%        | â†“     |
| docs     | 5       | 15       | 12%        | â†‘     |
| github   | 3       | 8        | 6%         | â†’     |
| infra    | 2       | 3        | 2%         | â†“     |
```

**Tools**:
- Markdown (Obsidian DataView)
- HTML table with sorting
- CSV export for spreadsheets

**Pros**:
- âœ… Simple to implement
- âœ… Works in Obsidian vault
- âœ… Easy to export/share

**Cons**:
- âŒ Less visual appeal
- âŒ No time-series patterns

---

### Option 4: Pie/Donut Chart (Current Distribution)

**What**: Shows current week/month category breakdown

**Layout**:
```
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â•±ops (35%)   â•²
  â”‚              â”‚
  â”‚  n8n (23%)   â”‚
  â”‚              â”‚
   â•² cortex (22%)â•±
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tools**:
- Chart.js pie/doughnut
- D3.js donut chart
- Google Charts

**Pros**:
- âœ… Instant category distribution view
- âœ… Simple, universally understood
- âœ… Good for reports/screenshots

**Cons**:
- âŒ No time-series information
- âŒ Limited to current period

---

### Option 5: Multi-Line Chart (Category Trends)

**What**: Separate line for each category showing trends

**Layout**:
```
Tasks
  10 â”‚
   8 â”‚         â”Œâ”€ops
   6 â”‚       â”Œâ”€n8n
   4 â”‚     â”Œâ”€cortex
   2 â”‚   â”Œâ”€docs
   0 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Time
```

**Tools**:
- Chart.js line chart
- Plotly.js
- ECharts

**Pros**:
- âœ… Clear individual category trends
- âœ… Easy to spot anomalies
- âœ… Good for comparing categories

**Cons**:
- âŒ Lines can overlap (readability issues)
- âŒ Doesn't show total workload

---

## Recommended Implementation: Hybrid Approach

### Phase 1: Static Table (Quick Win)

**Why**: Simplest to implement, works in Obsidian vault

**Implementation**:
1. Add script: `cortex/scripts/generate-category-summary.mjs`
2. Output: `cortex/summaries/category-analytics.md`
3. Schedule: Weekly update (Sunday nights)

**Example Output**:
```markdown
# Category Analytics Summary

**Period**: Last 30 days (2025-11-15 to 2025-12-15)
**Total Tasks**: 128

## Category Breakdown

| Category | Count | % of Total | Avg/Day | Trend (vs prev 30d) |
|----------|-------|------------|---------|---------------------|
| ops      | 45    | 35%        | 1.5     | +12% â†‘              |
| n8n      | 30    | 23%        | 1.0     | -5% â†“               |
| cortex   | 28    | 22%        | 0.9     | +8% â†‘               |
| docs     | 15    | 12%        | 0.5     | +2% â†’               |
| github   | 8     | 6%         | 0.3     | -10% â†“              |
| infra    | 2     | 2%         | 0.1     | 0% â†’                |

## Daily Breakdown (Last 7 Days)

| Date       | ops | n8n | cortex | docs | github | infra | Total |
|------------|-----|-----|--------|------|--------|-------|-------|
| 2025-12-15 |  2  |  1  |   1    |  1   |   0    |   0   |   5   |
| 2025-12-14 |  3  |  2  |   1    |  0   |   1    |   0   |   7   |
| ...        | ... | ... |  ...   | ...  |  ...   |  ...  |  ...  |

## Insights

- **Busiest Day**: 2025-12-14 (7 tasks)
- **Most Active Category**: ops (35% of total)
- **Growing Categories**: ops (+12%), cortex (+8%)
- **Declining Categories**: n8n (-5%), github (-10%)
```

**Pros**:
- âœ… Quick to implement (~1 hour)
- âœ… Works natively in Obsidian
- âœ… No external dependencies
- âœ… Markdown = version control friendly

---

### Phase 2: Interactive HTML Dashboard (Future)

**Why**: Better UX, more flexible visualizations

**Tech Stack**:
- **Frontend**: HTML + Chart.js + Tailwind CSS
- **Data**: Load `category_heatmap.json` via fetch
- **Hosting**: Static page in `public/cortex-dashboard.html`

**Features**:
1. **Date Range Selector**: Last 7d / 30d / 90d / All time
2. **Category Filter**: Show/hide specific categories
3. **Chart Type Toggle**: Stacked area / Multi-line / Pie chart
4. **Export**: PNG screenshot, CSV download
5. **Auto-refresh**: Reload data every 5 minutes

**Mockup**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Category Analytics Dashboard          [Export PNG] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Period: [Last 30d â–¼]  Chart: [Stacked Area â–¼]      â”‚
â”‚ Categories: [âœ“ops âœ“n8n âœ“cortex âœ“docs âœ“github]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚        [Stacked Area Chart Here]                    â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Summary:                                            â”‚
â”‚ â€¢ Total Tasks (30d): 128                            â”‚
â”‚ â€¢ Busiest Category: ops (45 tasks, 35%)             â”‚
â”‚ â€¢ Average Daily Tasks: 4.3                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Implementation Steps**:
1. Create `public/cortex-dashboard.html`
2. Add Chart.js from CDN
3. Fetch `../cortex/state/category_heatmap.json`
4. Render charts with date range controls
5. Add export functionality

**Estimated Effort**: 4-6 hours

---

### Phase 3: Obsidian Plugin (Advanced)

**Why**: Native Obsidian integration, live updates

**Features**:
- Live heatmap in Obsidian sidebar
- Click date â†’ view digest
- Inline category stats in daily notes
- Custom DataView queries

**Example DataView Query**:
```dataview
TABLE WITHOUT ID
  category,
  count(category) as "Count",
  round((count(category) / 128) * 100, 1) + "%" as "% of Total"
FROM "cortex/daily"
WHERE category != null
GROUP BY category
SORT count(category) DESC
```

**Estimated Effort**: 8-12 hours (requires Obsidian plugin dev)

---

## Metrics to Visualize

### Core Metrics

1. **Category Distribution** (current state)
   - Pie chart or donut chart
   - % breakdown by category

2. **Category Trends** (time-series)
   - Line chart or stacked area
   - Show growth/decline over time

3. **Daily Task Volume** (workload)
   - Bar chart or heatmap
   - Identify busy periods

4. **Category Velocity** (rate of change)
   - Trend arrows (â†‘ â†“ â†’)
   - Week-over-week comparison

### Advanced Metrics (Future)

5. **Category Correlation**
   - Heatmap showing category co-occurrence
   - "When n8n tasks spike, ops tasks also spike"

6. **Completion Time Patterns**
   - Time-to-complete by category
   - Requires task completion tracking (not yet implemented)

7. **Category Health Score**
   - Balance metric (ideal distribution vs actual)
   - Alert when one category dominates (>50%)

---

## Data Aggregation Functions

### Weekly Rollup

```javascript
function getWeeklyRollup(heatmap, startDate, endDate) {
  const weeks = {};
  for (const [date, counts] of Object.entries(heatmap)) {
    if (date < startDate || date > endDate) continue;
    const week = getWeekNumber(date); // e.g., "2025-W50"
    weeks[week] = weeks[week] || {};
    for (const [cat, count] of Object.entries(counts)) {
      weeks[week][cat] = (weeks[week][cat] || 0) + count;
    }
  }
  return weeks;
}
```

### Category Trend Calculation

```javascript
function getCategoryTrend(heatmap, category, days = 30) {
  const recent = getDateRange(heatmap, days);
  const previous = getDateRange(heatmap, days, days); // Previous 30d

  const recentTotal = sumCategory(recent, category);
  const previousTotal = sumCategory(previous, category);

  const change = ((recentTotal - previousTotal) / previousTotal) * 100;
  return {
    current: recentTotal,
    previous: previousTotal,
    change: change,
    trend: change > 5 ? 'â†‘' : change < -5 ? 'â†“' : 'â†’'
  };
}
```

---

## Recommended Next Steps

### Immediate (Phase 1)

1. âœ… Create `cortex/scripts/generate-category-summary.mjs`
2. âœ… Output Markdown summary to `cortex/summaries/category-analytics.md`
3. âœ… Add to cron (Sunday nights via n8n workflow)
4. âœ… Include in weekly Slack digest

### Short-term (Phase 2)

1. Create HTML dashboard prototype
2. Test with last 30 days of data
3. Add basic interactivity (date range filter)
4. Deploy to `/cortex-dashboard` route

### Long-term (Phase 3)

1. Evaluate Obsidian plugin vs standalone app
2. Add predictive analytics (forecast next week's categories)
3. Integrate with other Cortex metrics (health score, rhythm patterns)

---

## Related Files

- **Data Source**: `cortex/state/category_heatmap.json`
- **Script**: `cortex/scripts/generate-daily-digest.mjs` (updates heatmap)
- **Config**: `cortex/config/category-rules.json` (category definitions)
- **Completion Doc**: `cortex/roadmap/v1.3-category-analytics-completion.md`

---

**Last Updated**: 2025-12-15
**Status**: ðŸŽ¨ Design phase (implementation optional)
**Recommended Start**: Phase 1 (Markdown summary generator)
