# v1.3 "Intelligence" 移行チェックリスト

**現在地**: v1.2 "Autonomy" 完成（2025-12-05）
**目標**: v1.3 "Intelligence" 本格開始の土台確立
**期限**: 2025-12-20（1週間）

---

## 🎯 v1.3 入口条件（必須）

v1.3の「パターン学習」を開始するには、以下2つの観測基盤が必要：

### A) Automation Observability（実行ログの可視化）

**現状**: `no_data` (health-score.json)

**目標**: Recipe実行ログが毎日 `cortex/logs/` に蓄積される状態

**チェック項目**:
- [ ] `cortex/logs/` ディレクトリが存在する
- [ ] Recipe 02, 03, 10, 11, 13, 14 のログファイルが毎日生成される
- [ ] ログに実行時刻、成功/失敗、処理件数が含まれる
- [ ] `analyze-health.py` が7日分のログを解析できる

**最低仕様（Minimum Viable Logging）**:
- **形式**: JSONL (JSON Lines) - 1行1実行
- **必須フィールド**:
  ```json
  {
    "ts": "2025-12-14T08:05:30.123Z",
    "workflow": "Recipe 10: TODO.md Auto-sync",
    "executionId": "abc123",
    "status": "success|error",
    "durationMs": 1234,
    "env": "production|staging|local",
    "errorMessage": "エラー時のみ"
  }
  ```
- **保存期間**: 30日（ローカルは14日でも可）
- **検証条件**: `analyze-health.py --window-days 7` が `no_data` にならない

**実装アプローチ**:
1. n8n の各Recipeに「ログ出力ノード」追加
2. ファイル名形式: `cortex/logs/recipe-{XX}-{YYYY-MM-DD}.jsonl`
3. ログローテーション: 日次で新規ファイル作成

**所要時間**: 2-3時間（全Recipe修正）

---

### B) Category Analytics（カテゴリ別負荷分析）

**現状**: `category_samples: 0` (health-score.json)

**目標**: タスクにカテゴリが付与され、週次で100+サンプル蓄積

**チェック項目**:
- [ ] タスク抽出時にカテゴリ推定ロジックが動作
- [ ] `category_heatmap.json` に週次でデータが追記される
- [ ] カテゴリ: `dev`, `doc`, `ops`, `research`, `meeting` が識別される
- [ ] `analyze-health.py` がカテゴリ別統計を出力できる

**品質保証（Minimum Viable Quality）**:
- **カテゴリ欠損率**: `category_missing_rate < 20%`（80%以上は何らかのカテゴリ付与）
- **カテゴリ種類**: 最低5種 (`dev`, `doc`, `ops`, `research`, `meeting`)
- **手動修正ループ**: 週1回「誤分類トップ10」だけ修正（完璧を目指さない）
- **検証条件**: `category_heatmap.json` に週次で50+サンプルが追加される

**実装アプローチ**:
1. Recipe 14（Daily Digest Generator）にカテゴリ推定を追加
2. キーワードベース分類（例: "recipe", "n8n" → `ops`, "cortex/" → `dev`）
3. デフォルトカテゴリ: 判定不能な場合は `general`（欠損にしない）
4. 手動修正導線: 週次レビュー時に誤分類を直す軽量フロー

**所要時間**: 2-3時間（カテゴリロジック実装）

---

## 📅 v1.3 マイルストーン（段階的達成）

### Milestone 1: データ蓄積開始（1週間）

**目標日**: 2025-12-20

- [ ] Rhythm active days: 3 → 7
- [ ] Automation logs: `no_data` → `data_ok`
- [ ] `duration_stats.json`: 生成される
- [ ] Category samples: 0 → 50+

**成果**: 「統計が取れる最低限の母数」確保

---

### Milestone 2: 統計基盤確立（2週間）

**目標日**: 2025-12-27

- [ ] Rhythm active days: 10 達成
- [ ] Category samples: 100+
- [ ] 曜日×時間帯の負荷パターンが安定
- [ ] `analyze-workload.py` が有意な提案を出せる

**成果**: 「提案アルゴリズムの入力データ」が揃う

---

### Milestone 3: Adaptive提案開始（3-4週間）

**目標日**: 2025-12-30

- [ ] 負荷パターンに基づく優先度調整ロジック実装
- [ ] `/brief` が曜日・時間帯を考慮した提案を出す
- [ ] `/wrap-up` が翌日の負荷予測を含める
- [ ] Self-Improvement Loopの初期版（週次で改善提案）

**成果**: v1.3 "Intelligence" の価値実現

---

## 🔧 次の48時間でやること（優先順）

### 🔥 最優先（明朝08:05後）

**1. 正常系確定**（明朝 08:05 JST実行後）:
- [ ] n8n実行履歴: Recipe 10 Success
- [ ] vault TODO.md: `## Today — 2025-12-14` 存在
- [ ] `/diagnose`: `TODO.md (vault): ✅ Fresh` 表示
- [ ] **記録**: Recipe 10実行ログ（tasksAdded, statusCode, updatedAt）

**2. 運用防御追加**（成功確認後）:
- [ ] Recipe 10に Verify TODO Sync ノード追加
- [ ] Global Error Workflow（Debug版）作成
- [ ] 意図的エラーでテスト
- [ ] 本番版に置き換え

**所要時間**: 30分（確認）+ 20分（防御追加）

---

### ⚡ 推奨（48時間以内）

**3. Automation Logging基盤**:
- [ ] `cortex/logs/` ディレクトリ作成
- [ ] Recipe 10にログ出力ノード追加（試験実装）
- [ ] ログフォーマット確定
- [ ] 他Recipeへの展開計画

**4. Category推定プロトタイプ**:
- [ ] キーワードベース分類ロジック作成
- [ ] Recipe 14に組み込み
- [ ] 1週間分の手動検証

**所要時間**: 3-4時間（土日で完了可能）

---

## 📊 進捗追跡

### 現在のv1.3 Health Score

**Automation**: 50/100 (no_data)
**Analytics**: 45/100 (rhythm 3日, category 0)
**Overall**: 62/100

### 目標（Milestone 1達成時）

**Automation**: 75/100 (data_ok, 7日分ログ)
**Analytics**: 65/100 (rhythm 7日, category 50+)
**Overall**: 75/100

### 目標（Milestone 2達成時）

**Automation**: 90/100 (安定稼働)
**Analytics**: 80/100 (rhythm 10日, category 100+)
**Overall**: 85/100

---

## 🎯 成功条件（v1.3開始判定）

以下すべてを満たしたら、v1.3 "Intelligence" 本格開始：

1. ✅ Automation logsが7日分蓄積
2. ✅ Category samplesが50以上
3. ✅ Rhythm active daysが7以上
4. ✅ `duration_stats.json`が生成される
5. ✅ `analyze-health.py`がエラーなく実行できる

**判定日**: 2025-12-20（1週間後）

---

## 📅 v1.3 移行スケジュール

| 日付 | マイルストーン | 目標スコア | 備考 |
|------|------------|----------|------|
| 2025-12-13 | v1.2運用改善完了 | 62 | Recipe 10修正、診断改善 |
| 2025-12-14 | 正常系確定 + 防御追加 | 62 | Verify Node, Error Workflow |
| 2025-12-15 | **v1.3 Entry Gate pass** | **65** | **Observability + Category基盤** |
| 2025-12-20 | **Milestone 1達成** | **75** | 7日分ログ、50+サンプル |
| 2025-12-27 | Milestone 2達成 | 85 | 統計基盤確立 |
| 2025-12-30 | **v1.3完成** | **90** | Adaptive提案開始 |

**重要**: 2025-12-15の「Entry Gate pass」は、Logging基盤とCategory推定の両方が動作した時点で判定。この日以降、v1.3の本格的なデータ蓄積フェーズに入る。

---

**作成日**: 2025-12-13
**更新日**: 2025-12-13
**次回更新**: 2025-12-20（Milestone 1達成時）
