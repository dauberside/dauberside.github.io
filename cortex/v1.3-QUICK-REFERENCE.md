# Cortex OS v1.3 "Self-Aware" - Quick Reference

**Date**: 2025-12-01  
**Status**: âœ… Production Ready

---

## ðŸš€ Quick Start

### 1. Environment Setup

```bash
# Set environment variables
export WORKSPACE_ROOT="/Volumes/Extreme Pro/dauberside.github.io-1"
export OBSIDIAN_VAULT_PATH="/Volumes/Extreme Pro/dauberside.github.io-1/cortex"

# Or source from .env.mcp
cd "/Volumes/Extreme Pro/dauberside.github.io-1"
set -a
source .env.mcp
set +a
```

### 2. Query Knowledge Graph

```bash
# Human-readable output
node cortex/graph/cortex-query-tool.mjs "How do I debug MCP?"

# JSON output
node cortex/graph/cortex-query-tool.mjs "Weekly summary" --json
```

### 3. Start MCP Server

```bash
PORT=5555 node services/mcp/server.mjs
```

### 4. Test with HTTP

```bash
# GET request
curl "http://localhost:5555/cortex/query?query=test"

# POST request
curl -X POST http://localhost:5555/cortex/query \
  -H "Content-Type: application/json" \
  -d '{"query": "What should I focus on?"}'
```

---

## ðŸ“Š System Components

### Memory Priming System

| Component | Size | Purpose |
|-----------|------|---------|
| `cluster-summaries.json` | 10KB | Compressed cluster memory |
| `classify-query.mjs` | 7.4KB | Query classifier (92.5% accuracy) |
| `cortex-query-tool.mjs` | 7.0KB | Main tool implementation |
| `graph-v1.json` | 70KB | Full graph data |
| `clusters-v1.md` | 11KB | Human-readable brain map |

### Knowledge Clusters

| ID | Name | Size | Coverage | Use Cases |
|----|------|------|----------|-----------|
| 0 | MCP Technical Core | 136 | 73.9% | Protocol, stdio, troubleshooting |
| 1 | Daily Practice | 21 | 11.4% | Planning, reflection, tasks |
| 2 | Strategic Context | 13 | 7.1% | Roadmap, milestones, v1.2 |
| 3 | ADR | 8 | 4.3% | Decisions, rationale, history |
| 4 | Achievements | 6 | 3.3% | Weekly highlights, progress |

---

## ðŸŽ¯ Common Tasks

### Regenerate Knowledge Graph

```bash
cd cortex/graph

# 1. Build embeddings
node build-embeddings.mjs

# 2. Cluster concepts
node cluster.mjs

# 3. Export graph
node export-graph.mjs
```

### Validate Path Configuration

```bash
./scripts/validate-paths.sh
```

### Query Specific Cluster

```javascript
import { buildMemoryContext } from './cortex/graph/classify-query.mjs';

const context = await buildMemoryContext("MCP stdio debug");
console.log(context.selectedClusters); // ["cluster-0"]
```

---

## ðŸ”§ Configuration

### Environment Variables

| Variable | Host (macOS) | Container (Docker) |
|----------|-------------|-------------------|
| `WORKSPACE_ROOT` | `/Volumes/Extreme Pro/dauberside.github.io-1` | `/workspace/dauberside.github.io-1` |
| `OBSIDIAN_VAULT_PATH` | `/Volumes/Extreme Pro/dauberside.github.io-1/cortex` | `/workspace/dauberside.github.io-1/cortex` |

### MCP Servers

All servers auto-load env vars from `.mcp.json`:
- `cortex-filesystem` - Read Cortex files
- `cortex-terminal` - Execute tasks
- `cortex-query` - Query knowledge graph
- `obsidian` - Obsidian API bridge

---

## ðŸ“ˆ Performance

| Metric | Target | Actual |
|--------|--------|--------|
| Classification Speed | <10ms | **3ms** |
| Total Response | <50ms | **<50ms** |
| Memory Footprint | <20KB | **10-20KB** |
| Accuracy | â‰¥80% | **92.5%** |
| Context Reduction | >70% | **83%** |

---

## ðŸ§ª Testing

### Test Classification

```bash
cd cortex/graph

# Test all 20 validation queries
for query in \
  "How do I debug MCP?" \
  "What did I accomplish this week?" \
  "Where are we on roadmap?" \
do
  echo "Query: $query"
  node classify-query.mjs "$query" | grep "Selected clusters"
done
```

### Test MCP Integration

```bash
# Start server
PORT=5555 node services/mcp/server.mjs &

# Test endpoint
curl http://localhost:5555/cortex/query?query=test

# Stop server
pkill -f "node.*services/mcp/server.mjs"
```

---

## ðŸ“š Documentation Index

| Document | Purpose | Location |
|----------|---------|----------|
| **v1.3-COMPLETION-SUMMARY.md** | Complete session summary | `cortex/graph/` |
| **MEMORY-PRIMING-GUIDE.md** | Usage guide | `cortex/graph/` |
| **CLAUDE-INTEGRATION.md** | Claude Desktop setup | `cortex/graph/` |
| **PATH-NORMALIZATION-SUMMARY.md** | Path config details | `cortex/` |
| **PATH-MIGRATION-CHECKLIST.md** | Migration status | `cortex/` |
| **v1.3-QUICK-REFERENCE.md** | This file | `cortex/` |

---

## ðŸš¨ Troubleshooting

### "cortex_query_not_available"

**Cause**: Server couldn't load tool  
**Fix**: Check `OBSIDIAN_VAULT_PATH` is set and points to cortex directory

### "unauthorized" from MCP server

**Cause**: `MCP_API_TOKEN` is set  
**Fix**: For dev, start without token:
```bash
MCP_API_TOKEN="" PORT=5555 node services/mcp/server.mjs
```

### Classification returns wrong cluster

**Check**: Run validation script
```bash
./scripts/validate-paths.sh
```

**Improve**: Add keywords to `classify-query.mjs` CLASSIFICATION_RULES

### Paths not resolving

**Check env vars**:
```bash
echo $WORKSPACE_ROOT
echo $OBSIDIAN_VAULT_PATH
```

**Fix**: Source `.env.mcp` or set manually

---

## ðŸŽ¯ Next Steps

### Immediate
- [ ] Test with Claude Desktop
- [ ] Run n8n workflows in production
- [ ] Monitor classification accuracy

### Short-term (v1.3 polish)
- [ ] Add request logging/metrics
- [ ] Create cluster visualization
- [ ] Weekly graph refresh automation

### Mid-term (v1.4)
- [ ] Embedding-based classification
- [ ] Temporal concept tracking
- [ ] Concept drift detection
- [ ] Interactive cluster explorer

---

## ðŸ“ž Support

**Issues**: Create GitHub issue with:
- Environment (host/container)
- Command that failed
- Error message
- Output of `./scripts/validate-paths.sh`

**Questions**: Check documentation:
1. `MEMORY-PRIMING-GUIDE.md` - How to use
2. `v1.3-COMPLETION-SUMMARY.md` - What was built
3. `PATH-NORMALIZATION-SUMMARY.md` - Path configuration

---

**Last Updated**: 2025-12-01  
**Version**: v1.3.0  
**Status**: ðŸŸ¢ Production Ready
