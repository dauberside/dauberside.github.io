{
  "$schema": "https://modelcontextprotocol.io/schema/mcp.json",
  "version": "1.0.0",
  "mcpServers": {
    "obsidian": {
      "command": "uvx",
      "args": ["mcp-obsidian"],
      "env": {
        "OBSIDIAN_HOST": "${MCP_OBSIDIAN_HOST:-host.docker.internal}",
        "OBSIDIAN_PORT": "${MCP_OBSIDIAN_PORT:-27124}",
        "OBSIDIAN_API_KEY": "${MCP_OBSIDIAN_API_KEY}",
        "OBSIDIAN_HTTPS": "${MCP_OBSIDIAN_HTTPS:-true}"
      },
      "allowedTools": [
        "obsidian_get_file_contents",
        "obsidian_simple_search",
        "obsidian_list_files_in_vault",
        "obsidian_append_content",
        "obsidian_get_periodic_note"
      ],
      "metadata": {
        "priority": "high",
        "autoStart": true,
        "tokenUsage": "~4k tokens per session",
        "description": "Primary Obsidian vault access for knowledge ingestion and daily-note workflows",
        "notes": "host.docker.internal keeps compatibility when Claude runs inside Docker-enabled environments"
      }
    },
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "${MCP_GITHUB_TOKEN}"
      },
      "allowedTools": [
        "get_file_contents",
        "create_or_update_file",
        "search_repositories",
        "create_pull_request",
        "list_commits"
      ],
      "metadata": {
        "priority": "medium",
        "autoStart": false,
        "tokenUsage": "~3k tokens on-demand",
        "description": "GitHub integration for repo inspection and PR management (load only when needed)",
        "notes": "Requires PAT with repo, workflow scopes"
      }
    },
    "n8n-mcp": {
      "command": "npx",
      "args": ["n8n-mcp"],
      "env": {
        "MCP_MODE": "stdio",
        "LOG_LEVEL": "error",
        "DISABLE_CONSOLE_OUTPUT": "true",
        "N8N_API_URL": "${MCP_N8N_API_URL:-http://host.docker.internal:5678}",
        "N8N_API_KEY": "${MCP_N8N_API_KEY}"
      },
      "allowedTools": [
        "n8n_list_workflows",
        "n8n_get_workflow",
        "n8n_update_partial_workflow",
        "n8n_validate_workflow"
      ],
      "metadata": {
        "priority": "low",
        "autoStart": false,
        "tokenUsage": "~2k tokens only when invoked",
        "description": "n8n workflow bridge for automation tasks (lazy loaded)",
        "notes": "Default URL targets host.docker.internal so Docker containers can reach host n8n"
      }
    },
    "memory": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"],
      "env": {},
      "allowedTools": [
        "memory_store",
        "memory_retrieve",
        "memory_delete",
        "memory_search"
      ],
      "metadata": {
        "priority": "critical",
        "autoStart": true,
        "tokenUsage": "~1k tokens per session",
        "description": "Session memory for Cortex OS - maintains context across /brief, /wrap-up, /init cycles",
        "notes": "v1.1+ enhancement: persistent working memory for daily automation loops"
      }
    },
    "text-editor": {
      "command": "node",
      "args": ["services/mcp/text-editor.mjs"],
      "env": {},
      "allowedTools": [
        "write_file",
        "append_to_file",
        "insert_at_line",
        "replace_lines",
        "search_replace"
      ],
      "metadata": {
        "priority": "critical",
        "autoStart": true,
        "tokenUsage": "~500 tokens per session",
        "description": "Text editing for TODO.md, clusters-v1.md, and daily notes - enables OS to modify its own knowledge",
        "notes": "v1.1: Core capability - OS can now write back to TODO, clusters, and reflection notes"
      }
    },
    "fetch": {
      "command": "npx",
      "args": ["-y", "mcp-server-fetch"],
      "env": {},
      "allowedTools": [
        "fetch"
      ],
      "metadata": {
        "priority": "medium",
        "autoStart": false,
        "tokenUsage": "~500 tokens on-demand",
        "description": "HTTP client for kb-api, n8n webhooks, and external APIs",
        "notes": "Unified fetch interface - lazy loaded to minimize baseline context"
      }
    }
  },
  "settings": {
    "contextOptimization": {
      "enabled": true,
      "maxToolsPerServer": 8,
      "tierPriority": ["knowledge-base", "development", "automation"],
      "lazyLoadTiers": ["development", "automation"],
      "notes": "Baseline context trimmed to <15k tokens by limiting autoStart servers"
    },
    "security": {
      "requireEnvVars": true,
      "allowHardcodedSecrets": false,
      "notes": "Sync secrets via .env.mcp (ignored by git); never commit tokens"
    },
    "monitoring": {
      "logLevel": "error",
      "healthCheckInterval": 300,
      "notes": "Use /mcp diagnostics to review token usage and server health"
    }
  }
}
