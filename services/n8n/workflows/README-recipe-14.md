# Recipe 14: Daily Digest Generator

æ¯æœ07:00 JSTã«è‡ªå‹•çš„ã«Daily Digestãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€‚

## ğŸ“‹ æ¦‚è¦

- **å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°**: æ¯æ™© 00:30 JSTï¼ˆæ—¥ä»˜å¤‰æ›´å¾Œï¼‰
- **ç›®çš„**: TODO.mdã®ã€ŒTodayã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰**æ˜¨æ—¥ã®ã‚¿ã‚¹ã‚¯**ã‚’æŠ½å‡ºã—ã€Daily Digestãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ç”Ÿæˆ
- **å‡ºåŠ›å…ˆ**: `cortex/daily/YYYY-MM-DD-digest.md`ï¼ˆæ˜¨æ—¥ã®æ—¥ä»˜ï¼‰

## ğŸ”„ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æµã‚Œ

```
1. ãƒˆãƒªã‚¬ãƒ¼ï¼ˆ00:30 JSTï¼‰æ—¥ä»˜å¤‰æ›´å¾Œ
   â†“
2. ä»Šæ—¥ã®æ—¥ä»˜ã‚’è¨ˆç®—ï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå´ã§æ˜¨æ—¥ã®æ—¥ä»˜ã‚’è‡ªå‹•ç®—å‡ºï¼‰
   â†“
3. generate-daily-digest.mjs ã‚’å®Ÿè¡Œ
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æ˜¨æ—¥ï¼ˆJSTï¼‰ã® Digest ã‚’ç”Ÿæˆ
   - ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼ï¼ˆã‚µã‚¤ã‚ºãƒ»å¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ç½®æ›ç¢ºèªï¼‰
   â†“
4. æˆåŠŸ/å¤±æ•—ã‚’åˆ¤å®šï¼ˆexitCode === 0ï¼‰
   â†“
5. ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã‚’ç¢ºèªï¼ˆæˆåŠŸæ™‚ã®ã¿ï¼‰
   â†“
6. Slackã«é€šçŸ¥ï¼ˆæˆåŠŸ/å¤±æ•—ã©ã¡ã‚‰ã‚‚ï¼‰
```

## ğŸ“¥ n8nã¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ‰‹é †

### æ–¹æ³•1: n8n UIçµŒç”±ï¼ˆæ¨å¥¨ï¼‰

1. **n8n UIã«ã‚¢ã‚¯ã‚»ã‚¹**
   ```
   http://localhost:5678
   User: admin
   Password: 4A41423A-35F8-4B12-8F09-244B2AC736AD
   ```

2. **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ**
   - å·¦ä¸Šã®ã€Œ+ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã€ŒImport from Fileã€
   - `services/n8n/workflows/recipe-14-daily-digest-generator.json` ã‚’é¸æŠ
   - ã¾ãŸã¯ã€JSONã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ

3. **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ**
   - å³ä¸Šã®ã€ŒInactiveã€ãƒˆã‚°ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ŒActiveã€ã«å¤‰æ›´
   - ä¿å­˜ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

### æ–¹æ³•2: Docker ComposeçµŒç”±

```bash
# n8nã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•ï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èªè­˜ã•ã›ã‚‹ï¼‰
docker restart n8n

# èµ·å‹•å¾Œã€n8n UIã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç¢ºèª
```

## âœ… å‹•ä½œç¢ºèª

### 1. æ‰‹å‹•å®Ÿè¡Œãƒ†ã‚¹ãƒˆ

n8n UIã§ï¼š
1. Recipe 14ã‚’é–‹ã
2. ã€ŒExecute Workflowã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨Slacké€šçŸ¥ã‚’ç¢ºèª

### 2. ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆç¢ºèª

```bash
# æœ€æ–°ã®Digestãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
ls -lh cortex/daily/ | tail -3

# ä»Šæ—¥ã®Digestã®å†…å®¹ã‚’ç¢ºèª
TODAY=$(date +%Y-%m-%d)
cat cortex/daily/${TODAY}-digest.md
```

### 3. Slacké€šçŸ¥ç¢ºèª

æˆåŠŸæ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹ï¼š
```
âœ… Daily Digest Generated

ğŸ“… Date: 2025-11-30
ğŸ“ File: cortex/daily/2025-11-30-digest.md
â° Generated at: 2025-11-30T07:00:00.000Z

File info:
-rw-r--r--  1 node  node  1.2K Nov 30 07:00 cortex/daily/2025-11-30-digest.md
```

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "node: command not found"

n8nã‚³ãƒ³ãƒ†ãƒŠå†…ã«Node.jsãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š

```bash
docker exec n8n node --version
```

### ã‚¨ãƒ©ãƒ¼: "Permission denied"

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«å®Ÿè¡Œæ¨©é™ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š

```bash
chmod +x cortex/scripts/generate-daily-digest.mjs
```

### Slacké€šçŸ¥ãŒæ¥ãªã„

ç’°å¢ƒå¤‰æ•° `SLACK_DAILY_DIGEST_WEBHOOK` ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š

```bash
docker exec n8n printenv | grep SLACK_DAILY_DIGEST_WEBHOOK
```

## ğŸ“Š ä»–ã®Recipeã¨ã®é€£æº

### å®Ÿè¡Œé †åºï¼ˆ1æ—¥ã®æµã‚Œï¼‰

```
00:30  Recipe 14 â†’ æ˜¨æ—¥ã®Digestç”Ÿæˆï¼ˆæ—¥ä»˜å¤‰æ›´ç›´å¾Œï¼‰
   â†“
08:00  Recipe 03 â†’ æ˜¨æ—¥ã®Digestèª­ã¿å–ã‚Š â†’ Slacké€šçŸ¥
   â†“
08:00  Recipe 09 â†’ æ˜¨æ—¥ã®Digestèª­ã¿å–ã‚Š â†’ notifications/ æ›¸ãå‡ºã—
   â†“
08:05  Recipe 10 â†’ æ˜¨æ—¥ã®Digestèª­ã¿å–ã‚Š â†’ TODOåŒæœŸ
   â†“
22:00  Recipe 13 â†’ ä»Šæ—¥ã®Digestèª­ã¿å–ã‚Š â†’ tomorrow.jsonç”Ÿæˆ
```

### è¨­è¨ˆæ€æƒ³: "Digest = æ˜¨æ—¥ã®è¨˜éŒ²"

- **Digest ã¯ "1æ—¥ãŒçµ‚ã‚ã£ãŸã‚ã¨" ã«ç¢ºå®šã™ã‚‹**: 00:30 ã«æ˜¨æ—¥åˆ†ã‚’ç”Ÿæˆ
- **æœã®ãƒ«ãƒ¼ãƒ—ã¯ "æŒ¯ã‚Šè¿”ã‚Š"**: Recipe 03/09/10 ãŒæ˜¨æ—¥ã® Digest ã‚’èª­ã‚€
- **å¤œã®ãƒ«ãƒ¼ãƒ—ã¯ "ä»Šæ—¥ã‚’é–‰ã˜ã‚‹"**: Recipe 13 ãŒä»Šæ—¥ã® Digest ã‚’ tomorrow.json ã«é€ã‚‹

ã“ã®3å±¤æ§‹é€ ï¼ˆyesterday â†’ today â†’ tomorrowï¼‰ã«ã‚ˆã‚Šã€æ™‚ç³»åˆ—ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚

### ä¾å­˜é–¢ä¿‚

- **å…¥åŠ›**: TODO.mdï¼ˆTodayã‚»ã‚¯ã‚·ãƒ§ãƒ³ = æ˜¨æ—¥ã®ã‚¿ã‚¹ã‚¯ï¼‰
- **å‡ºåŠ›**: `cortex/daily/YYYY-MM-DD-digest.md`ï¼ˆæ˜¨æ—¥ã®æ—¥ä»˜ï¼‰
- **å¾Œç¶š**: Recipe 03, 09, 10, 13ãŒã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹

## ğŸ¯ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### å®Ÿè¡Œæ™‚åˆ»ã‚’å¤‰æ›´

`schedule-trigger` ãƒãƒ¼ãƒ‰ã® `hour` ã‚’å¤‰æ›´ï¼ˆ**UTCæ™‚åˆ»**ã§æŒ‡å®šï¼‰ï¼š

```json
{
  "hour": 15,   // 15:30 UTC = 00:30 JST (UTC+9)
  "minute": 30
}
```

**æ³¨æ„**: n8n ã® Schedule Trigger ã¯ UTC ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚JST ã§å¤‰æ›´ã—ãŸã„å ´åˆã¯ -9æ™‚é–“ã§è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚

### Slacké€šçŸ¥ã‚’ç„¡åŠ¹åŒ–

`Send Slack Notification` ãƒãƒ¼ãƒ‰ã‚’å‰Šé™¤ã€ã¾ãŸã¯ç„¡åŠ¹åŒ–

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

`cortex/templates/daily-digest-template.md` ã‚’ç·¨é›†

## ğŸ“š é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: `services/n8n/workflows/recipe-14-daily-digest-generator.json`
- **ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `cortex/scripts/generate-daily-digest.mjs`
- **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: `cortex/templates/daily-digest-template.md`
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `cortex/scripts/README-digest-generator.md`

---

**Created**: 2025-11-30
**Version**: 1.0
**Status**: Ready for production
**Maintainer**: Cortex OS Development Team
